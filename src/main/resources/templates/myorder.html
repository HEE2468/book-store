<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的订单</title>
    <link href="css/mycenter/style.css" type="text/css" rel="stylesheet"/>
    <link href="layui/css/layui.css" type="text/css" rel="stylesheet"/>
    <script src="layui/layui.js" type="text/javascript"></script>
    <script src="plugins/jquery/dist/jquery.min.js"></script>
</head>
<body>
<!-- header -->
<div class="site-header">
    <div class="site-logo">
        <img class="header-logo" src="images/logo.png">
    </div>
    <div class="header-nav">
        <ul class="nav-list">
            <li class="li-item-center">
                <a class="item-center" href="">我的订单</a>
            </li>
            <li class="li-item-logout">
                <a class="item-logout" onclick="logout()">退出</a>
            </li>
        </ul>
    </div>
</div>

<!-- 我的订单 -->
<div class="site-orders">
    <div class="site-orders-container">
        <h1 class="site-orders-title">我的订单</h1>
        <div class="site-orders-list">

            <table class="layui-table" id="table-layui" lay-filter="demo">
            </table>
        </div>
    </div>
</div>

</body>
<script src="js/logout.js" type="text/javascript"></script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<!-- 序号自动增长 -->
<script type="text/html" id="xuhao">
    {{d.LAY_TABLE_INDEX+1}}
</script>
<script>
    layui.use('table', function(){
        let table = layui.table;
        let tableIns = table.render({
            url: '/bank_book/order/findBookOrderById'
            ,headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            method:'post',
            where:{
                userId:window.sessionStorage.getItem("userId")
            },
            limits : [10,15,20,25],
            limit : 10
            , elem: '#table-layui'
            , page: true //开启分页
            , defaultToolbar: []
            , cols: [
                [ {checkbox: true, fixed: true}
                    ,{field:'', title: '序号', sort: true,width:50, fixed: true,align:"center", templet: "#xuhao"}
                    ,{field:'bookDetailsImg', title: '书籍封面',width:120,align:"center",
                        templet: '<div><img src="{{d.bookDetailsImg}}" style="height: 100px;width: 100px"></div><div>'}
                    ,{field:'bookName', title: '商品详情',width:120,align:"center"}
                    ,{field:'deliveryName', title: '收货人',width:180,align:"center"}
                    ,{field:'telephone', title: '收货电话',width:160,align:"center"}
                    ,{field:'address', title: '收货地址',width:100,align:"center"}
                    ,{field:'orderType', title: '订单状态',width:100,align:"center",
                        templet: function(res) {
                            //订单状态 10-已付款 20-配送中 30-已完成
                            switch (res.orderType) {
                                case 10: return '已付款';
                                case 20: return '配送中';
                                case 30: return '已完成';
                                default: return '';
                            }
                    }}
                    ,{field:'payType', title: '支付方式',width:100,align:"center",
                            templet: function(res) {
                            //订单状态 1-支付宝 2-微信 3-其他
                                switch (res.payType) {
                                    case 1: return '支付宝';
                                    case 2: return '微信';
                                    case 3:  return '其他';
                                    default: return '';
                                }
                        }}
                    ,{field:'orderDate', title: '下单时间',width:100,align:"center"}
                    ,{field:'price', title: '单价',width:100,align:"center"}
                    ,{field:'orderNumber', title: '数量',width:100,align:"center"}
                    ,{field:'amount', title: '总价',width:100,align:"center",
                            templet: function(res) {
                                if(res.orderNumber != '' && res.price !=''){
                                        return res.orderNumber*res.price;
                                 }else if(res.orderNumber != '' || res.price !=''){
                                    return 0.00;
                                }else{
                                    return '';
                                }

                    }}
                    ,{field:'right', title: '操作', width:177,toolbar:"#barDemo",align:"center"}
                    ]
            ],
            done: function (res, curr, count) {

            }

        });

        //监听表格复选框选择
        table.on('checkbox(demo)', function(obj){
            console.log(obj)
        });
        //监听工具条
        table.on('tool(demo)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.msg('ID：'+ data.id + ' 的查看操作');
            } else if(obj.event === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'edit'){
                layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }
        });

        var $ = layui.$, active = {
            getCheckData: function(){ //获取选中数据
                var checkStatus = table.checkStatus('idTest')
                    ,data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            }
            ,getCheckLength: function(){ //获取选中数目
                var checkStatus = table.checkStatus('idTest')
                    ,data = checkStatus.data;
                layer.msg('选中了：'+ data.length + ' 个');
            }
            ,isAll: function(){ //验证是否全选
                var checkStatus = table.checkStatus('idTest');
                layer.msg(checkStatus.isAll ? '全选': '未全选')
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</html>